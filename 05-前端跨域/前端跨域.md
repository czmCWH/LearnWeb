# 前端跨域

## 什么是前端跨域？

* 前端的站点都是通过浏览器访问，跨域是浏览器为了安全而做出的限制策略，防止人随意篡改、抓取数据。跨域是浏览器的限制，跟服务器没有关系。
* 跨域产生时，请求已经发送到服务器了，并且服务器也对这次请求进行了响应，只是浏览器不认这次响应。

> 浏览器和服务器 协议、域名、端口，有一个不一致就会产生跨域错误。浏览器请求必须遵循同源策略：同域名 && 同端口 && 同协议。
> 服务器和服务器如果进行数据通信，但是三要素(协议、域名、端口)不一致，也不会有跨域错误。

跨域的解决方案
1、CORS 跨域
2、代理跨域
3、JSONP 跨域 --- 主流方式

# 1、CORS 跨域

CORS 跨域 - 服务端设置，前端直接调用。
> 说明：后端配置前端请求的 Response Headers(响应头)，允许前端某个站点进行访问。

```
// 响应标头
Response Headers
    Access-Control-Allow-Credentials: true      // 允许把前端 cookies 发送给后端
    Access-Control-Allow-Origin: http://localhost:8080      // 指定访问接口的前端站点
```

# 2、代理跨域
接口代理 - 运维通过修改 nginx 服务器配置来实现
> 说明：前端修改，后台不动；


# 3、前端解决跨域

## 3.1、JSONP 跨域 - 前端适配，后端配合（了解，现在不用了）
> 说明：前后端同时改造，前端需要安装jsonp插件，后端需要对接口进行配置。
> 缺点：只支持 get 请求
> 原理：使用html中不受同源策略限制的标签(如：scriipt、link、img)来发起请求

## 3.2、工程化环境下的解决跨域的方案，webpack
> 缺点：只能解决开发环境下的跨域问题。上线之后依然要依赖后端和运维解决。
> 因为上线之后没有 webpack 支持网站运行，上线是打包后的产物。

配置完 proxy，相当于 webpack 已经给咱们启动了一个代理服务器，并且这个代理服务器的三要素是和咱们本地启动这个网站的三要素保持一致，即启动了 http://localhost:8888 这么一个代理服务器，这个服务器是看不到的。因此本地服务器请求的 API 也需要改成 `http://localhost:8888`。

代理服务器默认是不会帮助开发者转发和响应请求的，必须通过配置告诉代理服务器，那些请求是需要它来转发。如下是 [proxy配置](https://webpack.docschina.org/configuration/dev-server/#devserverproxy) 含义：

```json
/* proxy 以键值对的方式配置，可以配置多个让不同接口代理到不同的服务器
键('/api')：当请求的路径包含('/api')，代理服务器才进行转发请求
值({...})：
    - target：表示把键对应的请求 转发到的目标服务器地址。当代理服务进行转发时，会把原路径键('/api')之前的路径替换成target只有的路径，替换之后再转发请求。
    - pathRewrite：  
*
*/
module.exports = {
  //...
  devServer: {
    proxy: {    
      '/api': {
        target: 'https://other-server.example.com:8080',
        pathRewrite: { '^/api': '' },
        secure: false,
      },
    },
  },
};
```



